<!--<link href="js/nailthumb/jquery.nailthumb.1.1.css" type="text/css" rel="stylesheet"/>-->
<!---->

<script src="js/jquery.fileupload.js"></script>
<script src="js/jquery.fileupload-fp.js"></script>
<link href="js/fileuploader/fileuploader.css" rel="stylesheet" type="text/css">
<script src="js/fileuploader/fileuploader.js" type="text/javascript"></script>


<script>

    $(function () {
        $('#fileupload').fileupload({
            dataType:'json',
            forceIframeTransport:true,
            previewSourceFileTypes:'/^image\/(gif|jpeg|png|jpg)$/',
            fail:function (e, data) {
                //alert("xxx" + e + " " + data);
                for (i in e) {
                    console.log("-" + i + " " + e[i]);
                }
                for (i in data) {
                    console.log("-" + i + " " + data[i]);
                }
            },
            hideDropzones:false,
            done:function (e, data) {
                uploadFinished(data);
            }

        });
    });

    function createUploader() {
        var uploader = new qq.FileUploader({
            element:document.getElementById('file-uploader-demo1'),
            action:'rest/hello/findSimilar',
            forceMultipart:true,
            debug:false,
            onSubmit:localSubmit,
            onComplete:localFinished
        });
    }

    function localSubmit(id, name, json) {
        $('.qq-upload-list').children().remove();
        var img = document.createElement("img");
        // li.appendChild(img);
        reader = new FileReader();
        reader.onload = (function (theImg) {

            return function (evt) {
                theImg.src = evt.target.result;

            };
        }(img));
        reader.readAsDataURL(this._handler._files[id]);
        // display the source image
        $("#duplicate_upload_source").children().remove();
        $("#duplicate_upload_result").children().remove();
        div_t = document.createElement("div");
        div_t.className = "smallImage";
        div_t.style.float = "left";
        div_t.appendChild(img);


        //<img class="pathlink" src="data:image;base64,{{base64Data}}" title="{{path}}" style="height:auto; width:auto; max-width:100px; max-height:100px;"/>
        $("#duplicate_upload_source").append(div_t);
        jQuery(document).ready(function () {
            jQuery('.nailthumb-container').nailthumb();
            jQuery('.nailthumb-image-titles-animated-onhover').nailthumb();
        });


    }

    function localFinished(id, name, json) {
      //  uploadFinished(json.sourceSig, json.images);
        displaySimilarImages(json.sourceSig, json.images);
        $(".qq-upload-list").children().remove();
    }


    jQuery(document).ready(function () {
        createUploader();
    });

</script>

<div id="file-uploader-demo1" style="margin-left:10px">
    <noscript>
        <p>Please enable JavaScript to use file uploader.</p>
        <!-- or put a simple form for upload here -->
    </noscript>
</div>


<div id="duplicate_upload_source" style="margin:10px 10px"></div>

<!--<div style="margin-left:20px" >-->
<div id="duplicate_upload_result" style="margin-left:auto; margin-right:auto ; clear:both; height:80%; width:95%; overflow-x:hidden; overflow-y:auto"></div>
<!--</div>-->

<!--</body>-->
<!--</html>-->